<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema de Inspecci√≥n de Plumillas ‚Äî Flota</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
:root{
  --red:#cc1a1a;--red-dark:#a01414;--bg:#f4f5f7;--surface:#fff;
  --surface2:#f0f1f3;--border:#d0d3d9;--border-strong:#b0b5bf;
  --text:#1a1d23;--text2:#5a6070;--text3:#8a90a0;
  --blue:#1a5fa0;--green:#1a7a45;--orange:#c06010;
  --shadow:0 1px 4px rgba(0,0,0,.08),0 2px 12px rgba(0,0,0,.04);
  --shadow-md:0 2px 8px rgba(0,0,0,.10),0 4px 20px rgba(0,0,0,.06);
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;font-size:14px;}
.header{background:#1a1d23;border-bottom:3px solid var(--red);padding:0 40px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:200;height:64px;box-shadow:0 2px 12px rgba(0,0,0,.25);}
.logo{display:flex;align-items:center;gap:20px;}
.logo-icon{width:40px;height:40px;background:var(--red);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;}
.logo-divider{width:1px;height:32px;background:rgba(255,255,255,.15);}
.logo-text h1{font-size:16px;font-weight:700;letter-spacing:.8px;color:#fff;text-transform:uppercase;line-height:1.2;}
.logo-text span{font-size:10px;color:rgba(255,255,255,.45);letter-spacing:2px;text-transform:uppercase;}
.header-right{display:flex;gap:20px;align-items:center;}
.system-badge{background:rgba(26,122,69,.2);border:1px solid rgba(26,122,69,.5);color:#4ecf90;padding:4px 14px;border-radius:3px;font-size:10px;letter-spacing:2px;font-weight:700;display:flex;align-items:center;gap:7px;}
.live-dot{width:6px;height:6px;border-radius:50%;background:#4ecf90;animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.25}}
.clock-disp{font-family:"Courier New",Courier,monospace;font-size:12px;color:rgba(255,255,255,.45);letter-spacing:1px;}
.nav{background:var(--surface);border-bottom:1px solid var(--border);display:flex;padding:0 24px;box-shadow:var(--shadow);overflow-x:auto;}
.nav-btn{padding:14px 16px;font-size:11px;font-weight:700;letter-spacing:.8px;text-transform:uppercase;cursor:pointer;border:none;background:transparent;color:var(--text2);transition:all .15s;border-bottom:3px solid transparent;margin-bottom:-1px;white-space:nowrap;}
.nav-btn:hover{color:var(--text);background:var(--surface2);}
.nav-btn.active{color:var(--red);border-bottom-color:var(--red);background:rgba(204,26,26,.04);}
.main{padding:28px 40px;max-width:1440px;margin:0 auto;}
.tab{display:none;}.tab.active{display:block;animation:fadeIn .2s ease;}
@keyframes fadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}
.section-header{display:flex;align-items:center;gap:12px;margin-bottom:20px;padding-bottom:12px;border-bottom:1px solid var(--border);}
.section-header h2{font-size:12px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text2);white-space:nowrap;}
.sh-line{flex:1;height:1px;background:var(--border);}
.stats-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin-bottom:28px;}
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:18px 20px;display:flex;align-items:center;gap:14px;box-shadow:var(--shadow);cursor:pointer;transition:box-shadow .15s,transform .15s;position:relative;overflow:hidden;}
.stat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;}
.stat-card.c-red::before{background:var(--red);}.stat-card.c-blue::before{background:var(--blue);}
.stat-card.c-green::before{background:var(--green);}.stat-card.c-orange::before{background:var(--orange);}
.stat-card.c-gray::before{background:#6a7080;}
.stat-card:hover{transform:translateY(-2px);box-shadow:var(--shadow-md);}
.stat-icon{width:44px;height:44px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;}
.stat-card.c-red .stat-icon{background:rgba(204,26,26,.08);}.stat-card.c-blue .stat-icon{background:rgba(26,95,160,.08);}
.stat-card.c-green .stat-icon{background:rgba(26,122,69,.08);}.stat-card.c-orange .stat-icon{background:rgba(192,96,16,.08);}
.stat-card.c-gray .stat-icon{background:rgba(106,112,128,.08);}
.stat-num{font-family:"Courier New",Courier,monospace;font-size:26px;font-weight:600;line-height:1;}
.stat-card.c-red .stat-num{color:var(--red);}.stat-card.c-blue .stat-num{color:var(--blue);}
.stat-card.c-green .stat-num{color:var(--green);}.stat-card.c-orange .stat-num{color:var(--orange);}
.stat-card.c-gray .stat-num{color:#6a7080;}
.stat-label{font-size:10px;letter-spacing:1px;text-transform:uppercase;color:var(--text2);margin-top:3px;font-weight:600;}
.machines-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:14px;margin-bottom:28px;}
.machine-card{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:16px 14px;text-align:center;cursor:pointer;transition:all .15s;box-shadow:var(--shadow);}
.machine-card:hover{border-color:var(--red);box-shadow:var(--shadow-md);}
.machine-abbr{width:48px;height:48px;border-radius:50%;margin:0 auto 10px;background:#1a1d23;color:#fff;display:flex;align-items:center;justify-content:center;font-family:"Courier New",Courier,monospace;font-size:13px;font-weight:600;}
.machine-name{font-size:11px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--text);}
.machine-count{font-size:11px;color:var(--text2);margin-top:4px;font-weight:600;}
.machine-status{margin-top:8px;padding:3px 10px;border-radius:3px;font-size:9px;font-weight:700;letter-spacing:1.5px;display:inline-block;text-transform:uppercase;}
.status-ok{background:rgba(26,122,69,.1);color:var(--green);border:1px solid rgba(26,122,69,.3);}
.status-maint{background:rgba(192,96,16,.1);color:var(--orange);border:1px solid rgba(192,96,16,.3);}
.status-out{background:rgba(204,26,26,.1);color:var(--red);border:1px solid rgba(204,26,26,.3);}
.table-wrapper{background:var(--surface);border:1px solid var(--border);border-radius:6px;overflow:hidden;box-shadow:var(--shadow);}
.table-header{padding:14px 20px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);background:var(--surface2);flex-wrap:wrap;gap:8px;}
.table-header h3{font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text);}
table{width:100%;border-collapse:collapse;}
thead tr{background:var(--surface2);}
th{padding:10px 14px;text-align:left;font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text2);border-bottom:1px solid var(--border);white-space:nowrap;}
td{padding:11px 14px;font-size:13px;border-bottom:1px solid var(--surface2);color:var(--text);}
tr:last-child td{border-bottom:none;}
tr:hover td{background:rgba(0,0,0,.015);}
.mono{font-family:"Courier New",Courier,monospace;font-size:12px;}
.badge{padding:3px 9px;border-radius:3px;font-size:10px;font-weight:700;letter-spacing:.5px;display:inline-block;text-transform:uppercase;}
.badge-green{background:rgba(26,122,69,.1);color:var(--green);border:1px solid rgba(26,122,69,.25);}
.badge-orange{background:rgba(192,96,16,.1);color:var(--orange);border:1px solid rgba(192,96,16,.25);}
.badge-red{background:rgba(204,26,26,.1);color:var(--red);border:1px solid rgba(204,26,26,.25);}
.badge-blue{background:rgba(26,95,160,.1);color:var(--blue);border:1px solid rgba(26,95,160,.25);}
.badge-gray{background:rgba(106,112,128,.1);color:#6a7080;border:1px solid rgba(106,112,128,.25);}
.form-card{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:28px;box-shadow:var(--shadow);}
.fsect{font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--text2);margin-bottom:18px;padding-bottom:10px;border-bottom:1px solid var(--border);}
.form-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;}
.form-group{display:flex;flex-direction:column;gap:5px;}
.form-group.full{grid-column:1/-1;}
.form-group.half{grid-column:span 2;}
label{font-size:10px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--text2);}
input,select,textarea{background:var(--surface);border:1px solid var(--border);border-radius:4px;padding:9px 12px;color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;font-size:14px;transition:border-color .15s,box-shadow .15s;outline:none;}
input:focus,select:focus,textarea:focus{border-color:var(--red);box-shadow:0 0 0 3px rgba(204,26,26,.08);}
textarea{resize:vertical;min-height:80px;line-height:1.6;}
hr.fdiv{grid-column:1/-1;border:none;border-top:1px solid var(--border);margin:8px 0;}

/* CRITERIOS GRID */
.criterios-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:8px;}
.criterio-row{background:var(--surface2);border:1px solid var(--border);border-radius:5px;padding:12px 14px;display:flex;align-items:center;justify-content:space-between;gap:10px;}
.criterio-label{font-size:12px;font-weight:600;color:var(--text);flex:1;}
.criterio-code{font-family:"Courier New",Courier,monospace;font-size:10px;color:var(--text3);margin-right:8px;min-width:36px;}
.criterio-select{width:90px;padding:5px 8px;font-size:12px;font-weight:700;border:1px solid var(--border);border-radius:3px;background:var(--surface);}
.criterio-select.val-B{border-color:var(--green);color:var(--green);background:rgba(26,122,69,.06);}
.criterio-select.val-R{border-color:var(--orange);color:var(--orange);background:rgba(192,96,16,.06);}
.criterio-select.val-M{border-color:var(--red);color:var(--red);background:rgba(204,26,26,.06);}
.criterio-select.val-NA{border-color:#aaa;color:#6a7080;background:var(--surface2);}

/* PRIORIDAD BUTTONS */
.prioridad-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;}
.prio-btn{padding:10px 8px;border-radius:4px;border:1px solid var(--border);background:var(--surface2);color:var(--text2);font-size:11px;font-weight:700;letter-spacing:1px;text-transform:uppercase;cursor:pointer;transition:all .15s;text-align:center;}
.prio-btn:hover{border-color:var(--blue);color:var(--blue);background:rgba(26,95,160,.06);}
.prio-btn.selected.p-critico{border-color:var(--red);background:rgba(204,26,26,.1);color:var(--red);}
.prio-btn.selected.p-urgente{border-color:#c06010;background:rgba(192,96,16,.1);color:#c06010;}
.prio-btn.selected.p-moderado{border-color:#b8860b;background:rgba(184,134,11,.1);color:#b8860b;}
.prio-btn.selected.p-normal{border-color:var(--green);background:rgba(26,122,69,.1);color:var(--green);}

.obs-section{border:1px solid var(--border);border-radius:6px;overflow:hidden;margin-top:4px;}
.obs-header{background:var(--surface2);border-bottom:1px solid var(--border);padding:10px 16px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;}
.obs-title{font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text2);}
.obs-nivel{display:flex;gap:6px;flex-wrap:wrap;}
.obs-nivel-btn{padding:4px 12px;border-radius:3px;border:1px solid var(--border);background:transparent;color:var(--text2);font-size:10px;font-weight:700;cursor:pointer;text-transform:uppercase;transition:all .15s;}
.obs-nivel-btn.sel-info{border-color:var(--blue);background:rgba(26,95,160,.1);color:var(--blue);}
.obs-nivel-btn.sel-warning{border-color:var(--orange);background:rgba(192,96,16,.1);color:var(--orange);}
.obs-nivel-btn.sel-critical{border-color:var(--red);background:rgba(204,26,26,.1);color:var(--red);}
.obs-body{padding:16px;background:var(--surface);}
.obs-textarea{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:4px;padding:12px 14px;color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;font-size:14px;line-height:1.7;resize:vertical;min-height:90px;outline:none;transition:border-color .15s;}
.obs-textarea:focus{border-color:var(--red);box-shadow:0 0 0 3px rgba(204,26,26,.08);}
.obs-meta{display:flex;gap:14px;margin-top:12px;flex-wrap:wrap;}
.obs-meta input{flex:1;min-width:160px;background:var(--surface2);border:1px solid var(--border);border-radius:4px;padding:8px 12px;color:var(--text);font-family:-apple-system;font-size:13px;outline:none;}
.photo-upload-area{border:2px dashed var(--border);border-radius:6px;padding:20px;text-align:center;cursor:pointer;transition:all .15s;background:var(--surface2);position:relative;}
.photo-upload-area:hover,.photo-upload-area.dragover{border-color:var(--blue);background:rgba(26,95,160,.04);}
.photo-upload-area input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;}
.upload-text{font-size:13px;color:var(--text2);}
.upload-text strong{color:var(--blue);}
.upload-hint{font-size:11px;color:var(--text3);margin-top:4px;}
.photo-preview-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-top:14px;}
.photo-thumb{position:relative;border-radius:5px;overflow:hidden;border:1px solid var(--border);aspect-ratio:4/3;}
.photo-thumb img{width:100%;height:100%;object-fit:cover;display:block;}
.photo-thumb .photo-label{position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,.6);padding:3px 7px;font-size:9px;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.photo-thumb .photo-remove{position:absolute;top:4px;right:4px;width:18px;height:18px;border-radius:3px;background:rgba(204,26,26,.9);color:#fff;border:none;cursor:pointer;font-size:10px;display:flex;align-items:center;justify-content:center;}
.photo-count{font-size:11px;color:var(--blue);margin-top:6px;font-weight:600;}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;}
.cal-header-days{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;margin-bottom:3px;}
.cal-day-name{text-align:center;font-size:10px;font-weight:700;color:var(--text2);letter-spacing:1px;padding:6px 0;text-transform:uppercase;}
.cal-day{background:var(--surface);border:1px solid var(--border);border-radius:4px;padding:6px;min-height:60px;font-size:12px;color:var(--text2);}
.cal-day.has-event{border-color:var(--orange);}
.cal-day.today{border-color:var(--blue);background:rgba(26,95,160,.04);color:var(--text);font-weight:700;}
.cal-event{background:rgba(192,96,16,.1);border-left:2px solid var(--orange);padding:2px 5px;font-size:9px;color:var(--orange);margin-top:3px;border-radius:2px;text-transform:uppercase;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.cal-event.operativa{background:rgba(26,122,69,.1);border-left-color:var(--green);color:var(--green);}
.cal-event.critico{background:rgba(204,26,26,.1);border-left-color:var(--red);color:var(--red);}
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:1000;align-items:center;justify-content:center;}
.modal-overlay.show{display:flex;}
.detail-modal{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:28px;max-width:960px;width:95%;max-height:90vh;overflow-y:auto;box-shadow:0 8px 40px rgba(0,0,0,.2);}
.modal-title{font-size:12px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--text);margin-bottom:20px;padding-bottom:14px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;gap:10px;}
.detail-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px;}
.detail-field{background:var(--surface2);border-radius:4px;padding:11px 13px;border:1px solid var(--border);}
.df-label{font-size:9px;letter-spacing:1.5px;color:var(--text2);font-weight:700;text-transform:uppercase;margin-bottom:4px;}
.df-val{font-size:13px;color:var(--text);font-weight:600;}
.detail-photos{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:14px;}
.detail-photo{border-radius:5px;overflow:hidden;aspect-ratio:4/3;cursor:pointer;border:1px solid var(--border);}
.detail-photo img{width:100%;height:100%;object-fit:cover;transition:transform .2s;}
.detail-photo:hover img{transform:scale(1.04);}
.obs-display{background:var(--surface2);border-radius:5px;padding:14px;font-size:13px;color:var(--text);line-height:1.7;margin-top:8px;border-left:3px solid var(--orange);}
.obs-display.nivel-info{border-left-color:var(--blue);}
.obs-display.nivel-warning{border-left-color:var(--orange);}
.obs-display.nivel-critical{border-left-color:var(--red);}
.sub-section-title{font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text2);padding:16px 0 8px;border-top:1px solid var(--border);margin-top:16px;}
.kpi-row{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:24px;}
.kpi-box{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:16px;text-align:center;box-shadow:var(--shadow);}
.kpi-num{font-family:"Courier New",Courier,monospace;font-size:28px;font-weight:700;line-height:1;}
.kpi-label{font-size:10px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--text2);margin-top:5px;}
.kpi-box.kpi-red .kpi-num{color:var(--red);}.kpi-box.kpi-blue .kpi-num{color:var(--blue);}
.kpi-box.kpi-green .kpi-num{color:var(--green);}.kpi-box.kpi-orange .kpi-num{color:var(--orange);}
.charts-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-bottom:24px;}
.chart-card{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:20px;box-shadow:var(--shadow);}
.chart-title{font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text2);margin-bottom:16px;padding-bottom:10px;border-bottom:1px solid var(--border);}
.bar-row{display:flex;align-items:center;gap:8px;margin-bottom:9px;}
.bar-label{font-size:10px;font-weight:700;color:var(--text);min-width:82px;text-align:right;text-transform:uppercase;letter-spacing:.5px;}
.bar-track{flex:1;background:var(--surface2);border-radius:3px;height:22px;overflow:hidden;border:1px solid var(--border);}
.bar-fill{height:100%;border-radius:2px;display:flex;align-items:center;padding-left:8px;font-size:11px;font-weight:700;color:#fff;min-width:28px;transition:width .6s ease;}
.bar-val{font-size:11px;font-weight:700;color:var(--text);min-width:28px;font-family:"Courier New",Courier,monospace;}
.obs-feed{display:flex;flex-direction:column;gap:14px;}
.obs-card{background:var(--surface);border:1px solid var(--border);border-left:4px solid var(--blue);border-radius:6px;padding:18px;box-shadow:var(--shadow);}
.obs-card.c-CRITICO{border-left-color:var(--red);}
.obs-card.c-ADVERTENCIA{border-left-color:var(--orange);}
.obs-card.c-INFO{border-left-color:var(--blue);}
.obs-card-top{display:flex;align-items:center;gap:10px;margin-bottom:10px;flex-wrap:wrap;}
.obs-card-motivo{background:var(--surface2);border:1px solid var(--border);border-radius:4px;padding:10px 14px;margin-bottom:10px;}
.obs-card-motivo-label{font-size:9px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text2);margin-bottom:4px;}
.obs-card-obs{background:rgba(26,95,160,.04);border:1px solid rgba(26,95,160,.15);border-radius:4px;padding:10px 14px;margin-bottom:10px;}
.obs-card-obs.c-CRITICO{background:rgba(204,26,26,.04);border-color:rgba(204,26,26,.15);}
.obs-card-obs.c-ADVERTENCIA{background:rgba(192,96,16,.04);border-color:rgba(192,96,16,.15);}
.obs-card-meta{display:flex;gap:16px;flex-wrap:wrap;font-size:12px;color:var(--text2);border-top:1px solid var(--border);padding-top:10px;}
.btn-row{display:flex;gap:10px;margin-top:24px;justify-content:flex-end;border-top:1px solid var(--border);padding-top:20px;flex-wrap:wrap;}
.btn{padding:10px 24px;border-radius:4px;border:none;cursor:pointer;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;font-size:12px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;transition:all .15s;}
.btn-primary{background:var(--red);color:#fff;}
.btn-primary:hover{background:var(--red-dark);box-shadow:0 3px 12px rgba(204,26,26,.3);}
.btn-secondary{background:var(--surface2);color:var(--text2);border:1px solid var(--border);}
.btn-secondary:hover{color:var(--text);border-color:var(--border-strong);}
.btn-sql{background:rgba(26,95,160,.08);color:var(--blue);border:1px solid rgba(26,95,160,.3);}
.btn-sql:hover{background:rgba(26,95,160,.14);}
.toast{position:fixed;bottom:24px;right:24px;z-index:9999;background:#1a1d23;border:1px solid var(--green);color:#4ecf90;padding:12px 20px;border-radius:5px;font-size:13px;font-weight:600;box-shadow:0 4px 20px rgba(0,0,0,.2);display:none;animation:slideUp .25s ease;}
@keyframes slideUp{from{transform:translateY(14px);opacity:0}to{transform:translateY(0);opacity:1}}

/* Criterios detail table in modal */
.criterios-table{width:100%;border-collapse:collapse;margin-top:8px;}
.criterios-table th{padding:7px 10px;font-size:10px;font-weight:700;letter-spacing:1.2px;text-transform:uppercase;color:var(--text2);background:var(--surface2);border-bottom:1px solid var(--border);text-align:left;}
.criterios-table td{padding:8px 10px;font-size:12px;border-bottom:1px solid var(--surface2);}
.criterios-table tr:last-child td{border-bottom:none;}
.crit-B{color:var(--green);font-weight:700;}.crit-R{color:var(--orange);font-weight:700;}.crit-M{color:var(--red);font-weight:700;}.crit-NA{color:var(--text3);}

@media(max-width:960px){
  .stats-grid,.machines-grid,.charts-grid,.kpi-row{grid-template-columns:repeat(2,1fr);}
  .form-grid{grid-template-columns:1fr;}
  .criterios-grid{grid-template-columns:1fr;}
  .photo-preview-grid,.detail-photos{grid-template-columns:repeat(2,1fr);}
  .detail-grid{grid-template-columns:repeat(2,1fr);}
  .main{padding:20px 16px;}
  .header,.nav{padding-left:12px;padding-right:12px;}
}
</style>
</head>
<body>

<!-- HEADER -->
<header class="header">
  <div class="logo">
    <div class="logo-icon">ü™ü</div>
    <div class="logo-divider"></div>
    <div class="logo-text">
      <h1>Sistema de Inspecci√≥n de Plumillas</h1>
      <span>Control de Flota &nbsp;¬∑&nbsp; Registro de Inspecciones &nbsp;¬∑&nbsp; Seguimiento de Hallazgos</span>
    </div>
  </div>
  <div class="header-right">
    <div class="system-badge"><div class="live-dot"></div>SISTEMA EN L√çNEA</div>
    <span class="clock-disp" id="clockDisplay"></span>
  </div>
</header>

<!-- NAV -->
<nav class="nav">
  <button class="nav-btn active" onclick="showTab('dashboard')">Dashboard</button>
  <button class="nav-btn" onclick="showTab('registro')">Registrar Inspecci√≥n</button>
  <button class="nav-btn" onclick="showTab('historial')">Historial</button>
  <button class="nav-btn" onclick="showTab('estadisticas')">Estad√≠sticas</button>
  <button class="nav-btn" onclick="showTab('observaciones')">Observaciones</button>
  <button class="nav-btn" onclick="showTab('calendario')">Calendario</button>
</nav>

<div class="main">

<!-- ===== DASHBOARD ===== -->
<div class="tab active" id="tab-dashboard">
  <div class="section-header"><h2>Resumen General</h2><div class="sh-line"></div></div>
  <div class="stats-grid">
    <div class="stat-card c-blue"><div class="stat-icon">üìã</div><div><div class="stat-num" id="stat-total">0</div><div class="stat-label">Total Inspecciones</div></div></div>
    <div class="stat-card c-red"><div class="stat-icon">üö®</div><div><div class="stat-num" id="stat-critico">0</div><div class="stat-label">Cr√≠ticas</div></div></div>
    <div class="stat-card c-orange"><div class="stat-icon">‚ö†Ô∏è</div><div><div class="stat-num" id="stat-urgente">0</div><div class="stat-label">Urgentes</div></div></div>
    <div class="stat-card c-green"><div class="stat-icon">‚úÖ</div><div><div class="stat-num" id="stat-operativa">0</div><div class="stat-label">Operativas</div></div></div>
    <div class="stat-card c-gray"><div class="stat-icon">üîß</div><div><div class="stat-num" id="stat-mant">0</div><div class="stat-label">En Mantenimiento</div></div></div>
  </div>

  <div class="section-header"><h2>Estado de Flota</h2><div class="sh-line"></div></div>
  <div class="machines-grid">
    <div class="machine-card" onclick="selectMachine('CARGADOR FRONTAL')"><div class="machine-abbr">CF</div><div class="machine-name">Cargador Frontal</div><div class="machine-count" id="count-CF">0 inspecciones</div><div class="machine-status status-ok" id="status-CF">OPERATIVO</div></div>
    <div class="machine-card" onclick="selectMachine('TRACTOR')"><div class="machine-abbr">TR</div><div class="machine-name">Tractor</div><div class="machine-count" id="count-TR">0 inspecciones</div><div class="machine-status status-ok" id="status-TR">OPERATIVO</div></div>
    <div class="machine-card" onclick="selectMachine('CISTERNA')"><div class="machine-abbr">CI</div><div class="machine-name">Cisterna</div><div class="machine-count" id="count-CI">0 inspecciones</div><div class="machine-status status-ok" id="status-CI">OPERATIVO</div></div>
    <div class="machine-card" onclick="selectMachine('BARREDORA')"><div class="machine-abbr">BA</div><div class="machine-name">Barredora</div><div class="machine-count" id="count-BA">0 inspecciones</div><div class="machine-status status-ok" id="status-BA">OPERATIVO</div></div>
    <div class="machine-card" onclick="selectMachine('VOLQUETE')"><div class="machine-abbr">VO</div><div class="machine-name">Volquete</div><div class="machine-count" id="count-VO">0 inspecciones</div><div class="machine-status status-ok" id="status-VO">OPERATIVO</div></div>
  </div>

  <div class="table-wrapper">
    <div class="table-header"><h3>√öltimas Inspecciones</h3><button class="btn btn-secondary" style="font-size:11px;padding:7px 14px" onclick="showTab('historial')">VER TODO ‚Üí</button></div>
    <table>
      <thead><tr><th>N¬∞ Reg.</th><th>Fecha</th><th>Unidad</th><th>C√≥digo</th><th>Conductor</th><th>Prioridad</th><th>Estado</th><th>Obs.</th></tr></thead>
      <tbody id="recent-tbody"><tr><td colspan="8" style="text-align:center;color:var(--text2);padding:32px">Sin registros a√∫n.</td></tr></tbody>
    </table>
  </div>
</div>

<!-- ===== REGISTRO ===== -->
<div class="tab" id="tab-registro">
  <div class="form-card">
    <div class="fsect">Datos de la Inspecci√≥n</div>
    <div class="form-grid">
      <div class="form-group">
        <label>Tipo de Unidad</label>
        <select id="f-maquina">
          <option value="">-- Seleccionar --</option>
          <option>CARGADOR FRONTAL</option><option>TRACTOR</option>
          <option>CISTERNA</option><option>BARREDORA</option><option>VOLQUETE</option>
        </select>
      </div>
      <div class="form-group">
        <label>C√≥digo / Placa</label>
        <input type="text" id="f-codigo" placeholder="CAT 966 H16 / TQF-919">
      </div>
      <div class="form-group">
        <label>Fecha de Inspecci√≥n</label>
        <input type="date" id="f-fecha">
      </div>
      <div class="form-group">
        <label>Conductor</label>
        <input type="text" id="f-conductor" placeholder="Nombre del conductor">
      </div>
      <div class="form-group">
        <label>Turno</label>
        <select id="f-turno">
          <option value="A">Turno A</option>
          <option value="B">Turno B</option>
          <option value="C">Turno C</option>
        </select>
      </div>
      <div class="form-group">
        <label>Inspector</label>
        <input type="text" id="f-inspector" placeholder="Nombre del inspector">
      </div>

      <hr class="fdiv">

      <!-- PRIORIDAD -->
      <div class="form-group full">
        <label>Prioridad / Resultado de Inspecci√≥n</label>
        <div class="prioridad-grid">
          <div class="prio-btn p-critico" onclick="selectPrioridad(this,'CR√çTICO')">üö® Cr√≠tico</div>
          <div class="prio-btn p-urgente" onclick="selectPrioridad(this,'URGENTE')">‚ö†Ô∏è Urgente</div>
          <div class="prio-btn p-moderado" onclick="selectPrioridad(this,'MODERADO')">üî∂ Moderado</div>
          <div class="prio-btn p-normal" onclick="selectPrioridad(this,'NORMAL')">‚úÖ Normal</div>
        </div>
        <input type="hidden" id="f-prioridad">
      </div>

      <!-- ESTADO -->
      <div class="form-group">
        <label>Estado de la Unidad</label>
        <select id="f-estado">
          <option value="OPERATIVA">OPERATIVA</option>
          <option value="MANTENIMIENTO URGENTE">MANTENIMIENTO URGENTE</option>
          <option value="MANTENIMIENTO CORRECTIVO">MANTENIMIENTO CORRECTIVO</option>
          <option value="LIMPIEZA PREVENTIVA">LIMPIEZA PREVENTIVA</option>
          <option value="FUERA DE SERVICIO">FUERA DE SERVICIO</option>
        </select>
      </div>

      <hr class="fdiv">

      <!-- CRITERIOS DE INSPECCI√ìN -->
      <div class="form-group full">
        <div class="fsect" style="border:none;padding:0;margin-bottom:14px">Criterios de Inspecci√≥n &nbsp;<span style="font-size:10px;font-weight:400;color:var(--text3)">(B = Bueno | R = Regular | M = Malo | N/A = No Aplica)</span></div>
        <div class="criterios-grid">
          <div class="criterio-row"><span class="criterio-code">CS01</span><span class="criterio-label">Estado de la goma (desgaste, rajaduras, endurecimiento)</span><select class="criterio-select" id="cs01" onchange="colorCriterio(this)"><option value="B">B</option><option value="R">R</option><option value="M">M</option><option value="NA">N/A</option></select></div>
          <div class="criterio-row"><span class="criterio-code">CS02</span><span class="criterio-label">Presi√≥n de contacto con el parabrisas</span><select class="criterio-select" id="cs02" onchange="colorCriterio(this)"><option value="B">B</option><option value="R">R</option><option value="M">M</option><option value="NA">N/A</option></select></div>
          <div class="criterio-row"><span class="criterio-code">CS03</span><span class="criterio-label">Limpieza y ausencia de barro/grasa en la goma</span><select class="criterio-select" id="cs03" onchange="colorCriterio(this)"><option value="B">B</option><option value="R">R</option><option value="M">M</option><option value="NA">N/A</option></select></div>
          <div class="criterio-row"><span class="criterio-code">CS04</span><span class="criterio-label">Estado del brazo portaplumilla (doblado, corrosi√≥n, bisagra)</span><select class="criterio-select" id="cs04" onchange="colorCriterio(this)"><option value="B">B</option><option value="R">R</option><option value="M">M</option><option value="NA">N/A</option></select></div>
          <div class="criterio-row"><span class="criterio-code">CS06</span><span class="criterio-label">Velocidades de operaci√≥n (lenta / r√°pida)</span><select class="criterio-select" id="cs06" onchange="colorCriterio(this)"><option value="B">B</option><option value="R">R</option><option value="M">M</option><option value="NA">N/A</option></select></div>
          <div class="criterio-row"><span class="criterio-code">CS07</span><span class="criterio-label">Funcionamiento del sistema de lavado</span><select class="criterio-select" id="cs07" onchange="colorCriterio(this)"><option value="B">B</option><option value="R">R</option><option value="M">M</option><option value="NA">N/A</option></select></div>
          <div class="criterio-row"><span class="criterio-code">CS08</span><span class="criterio-label">Nivel de l√≠quido limpiaparabrisas</span><select class="criterio-select" id="cs08" onchange="colorCriterio(this)"><option value="B">B</option><option value="R">R</option><option value="M">M</option><option value="NA">N/A</option></select></div>
          <div class="criterio-row"><span class="criterio-code">CS09</span><span class="criterio-label">Estado de las toberas de rociado (obstrucci√≥n/direcci√≥n)</span><select class="criterio-select" id="cs09" onchange="colorCriterio(this)"><option value="B">B</option><option value="R">R</option><option value="M">M</option><option value="NA">N/A</option></select></div>
          <div class="criterio-row"><span class="criterio-code">CS10</span><span class="criterio-label">Limpieza y visibilidad del parabrisas tras operaci√≥n</span><select class="criterio-select" id="cs10" onchange="colorCriterio(this)"><option value="B">B</option><option value="R">R</option><option value="M">M</option><option value="NA">N/A</option></select></div>
          <div class="criterio-row"><span class="criterio-code">CS11</span><span class="criterio-label">Plumilla trasera / lateral (si aplica)</span><select class="criterio-select" id="cs11" onchange="colorCriterio(this)"><option value="B">B</option><option value="R">R</option><option value="M">M</option><option value="NA">N/A</option></select></div>
        </div>
      </div>

      <!-- HALLAZGOS -->
      <div class="form-group full">
        <label>Hallazgos Principales</label>
        <textarea id="f-hallazgos" placeholder="Describa los hallazgos principales, fallas observadas y condici√≥n de la unidad..." style="min-height:80px"></textarea>
      </div>
      <div class="form-group full">
        <label>Medidas a Tomar</label>
        <textarea id="f-medidas" placeholder="Acciones correctivas o preventivas programadas..." style="min-height:60px"></textarea>
      </div>
      <div class="form-group">
        <label>Pr√≥xima Inspecci√≥n</label>
        <input type="date" id="f-proxima">
      </div>

      <hr class="fdiv">
      <div class="form-group full">
        <div class="fsect" style="border:none;padding:0;margin-bottom:12px">Evidencia Fotogr√°fica</div>
        <div class="photo-upload-area" id="upload-area">
          <input type="file" id="f-fotos" accept="image/*" multiple onchange="handlePhotos(this.files)">
          <div class="upload-text" style="font-size:11px;font-weight:700;letter-spacing:1px;text-transform:uppercase;margin-bottom:4px">[ ADJUNTAR FOTOGRAF√çAS ]</div>
          <div class="upload-text">Arrastre las im√°genes aqu√≠ o <strong>haga clic para seleccionar</strong></div>
          <div class="upload-hint">JPG, PNG, WEBP ‚Äî M√°ximo 5 fotograf√≠as</div>
        </div>
        <div class="photo-preview-grid" id="photo-preview"></div>
        <div class="photo-count" id="photo-count"></div>
      </div>

      <hr class="fdiv">
      <div class="form-group full">
        <div class="fsect" style="border:none;padding:0;margin-bottom:12px">Observaciones para Jefatura</div>
        <div class="obs-section">
          <div class="obs-header">
            <span class="obs-title">Nivel de Criticidad</span>
            <div class="obs-nivel">
              <button class="obs-nivel-btn sel-info" id="obs-btn-info" onclick="selectNivel('INFO')">Informativo</button>
              <button class="obs-nivel-btn" id="obs-btn-warning" onclick="selectNivel('ADVERTENCIA')">Advertencia</button>
              <button class="obs-nivel-btn" id="obs-btn-critical" onclick="selectNivel('CRITICO')">Cr√≠tico</button>
            </div>
          </div>
          <div class="obs-body">
            <textarea class="obs-textarea" id="f-observaciones" placeholder="Observaciones adicionales para jefatura: riesgos operativos, recomendaciones, condici√≥n cr√≠tica..."></textarea>
            <div class="obs-meta">
              <input type="text" id="f-obs-reporta" placeholder="Reportado por">
              <input type="text" id="f-obs-jefatura" placeholder="Dirigido a (Jefe / Supervisor)">
            </div>
          </div>
        </div>
        <input type="hidden" id="f-obs-nivel" value="INFO">
      </div>
    </div>
    <div class="btn-row">
      <button class="btn btn-secondary" onclick="clearForm()">Limpiar</button>
      <button class="btn btn-primary" onclick="guardarRegistro()">Guardar Inspecci√≥n</button>
    </div>
  </div>
</div>

<!-- ===== HISTORIAL ===== -->
<div class="tab" id="tab-historial">
  <div class="table-wrapper">
    <div class="table-header">
      <h3>Historial Completo de Inspecciones</h3>
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <select id="filtro-maquina" onchange="renderHistorial()" style="font-size:12px;padding:6px 12px;background:var(--surface2);border:1px solid var(--border);color:var(--text);border-radius:4px">
          <option value="">Todas las unidades</option>
          <option>CARGADOR FRONTAL</option><option>TRACTOR</option>
          <option>CISTERNA</option><option>BARREDORA</option><option>VOLQUETE</option>
        </select>
        <select id="filtro-prioridad" onchange="renderHistorial()" style="font-size:12px;padding:6px 12px;background:var(--surface2);border:1px solid var(--border);color:var(--text);border-radius:4px">
          <option value="">Todas las prioridades</option>
          <option>CR√çTICO</option><option>URGENTE</option><option>MODERADO</option><option>NORMAL</option>
        </select>
        <button class="btn btn-sql" style="font-size:11px;padding:7px 14px" onclick="exportarExcel()">Exportar Excel</button>
      </div>
    </div>
    <table>
      <thead><tr><th>N¬∞ Reg.</th><th>Fecha</th><th>Unidad</th><th>C√≥digo</th><th>Conductor</th><th>Prioridad</th><th>Estado</th><th>Obs.</th><th>Detalle</th><th>Eliminar</th></tr></thead>
      <tbody id="historial-tbody"><tr><td colspan="10" style="text-align:center;color:var(--text2);padding:32px">Sin registros a√∫n.</td></tr></tbody>
    </table>
  </div>
</div>

<!-- ===== ESTAD√çSTICAS ===== -->
<div class="tab" id="tab-estadisticas">
  <div class="section-header">
    <h2>Indicadores Clave ‚Äî KPI</h2><div class="sh-line"></div>
    <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
      <select id="filtro-estadistica" onchange="renderEstadisticas()" style="font-size:12px;padding:7px 14px;background:var(--surface2);border:1px solid var(--border);color:var(--text);border-radius:4px;font-weight:700">
        <option value="">TODAS LAS UNIDADES</option>
        <option value="CARGADOR FRONTAL">CARGADOR FRONTAL</option>
        <option value="TRACTOR">TRACTOR</option>
        <option value="CISTERNA">CISTERNA</option>
        <option value="BARREDORA">BARREDORA</option>
        <option value="VOLQUETE">VOLQUETE</option>
      </select>
      <button class="btn btn-sql" style="font-size:11px;padding:7px 14px" onclick="exportarExcel()">Exportar Excel</button>
    </div>
  </div>
  <div class="kpi-row">
    <div class="kpi-box kpi-blue"><div class="kpi-num" id="kpi-total">0</div><div class="kpi-label">Total Inspecciones</div></div>
    <div class="kpi-box kpi-red"><div class="kpi-num" id="kpi-critico">0</div><div class="kpi-label">Cr√≠ticas / Urgentes</div></div>
    <div class="kpi-box kpi-orange"><div class="kpi-num" id="kpi-hallazgos">0</div><div class="kpi-label">Con Hallazgos</div></div>
    <div class="kpi-box kpi-green"><div class="kpi-num" id="kpi-operativas">0</div><div class="kpi-label">Operativas</div></div>
  </div>
  <div class="charts-grid">
    <div class="chart-card"><div class="chart-title">Inspecciones por Unidad</div><div id="ch-maq"></div></div>
    <div class="chart-card"><div class="chart-title">Distribuci√≥n por Prioridad</div><div id="ch-prio"></div></div>
    <div class="chart-card"><div class="chart-title">Estado de Unidades</div><div id="ch-estado"></div></div>
    <div class="chart-card"><div class="chart-title">Falla CS01 ‚Äî Goma</div><div id="ch-cs01"></div></div>
    <div class="chart-card"><div class="chart-title">Falla CS07 ‚Äî Sistema Lavado</div><div id="ch-cs07"></div></div>
    <div class="chart-card"><div class="chart-title">Falla CS09 ‚Äî Toberas</div><div id="ch-cs09"></div></div>
  </div>
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-bottom:24px">
    <div class="chart-card" style="grid-column:1/-1">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;padding-bottom:10px;border-bottom:1px solid var(--border);flex-wrap:wrap;gap:8px">
        <div class="chart-title" style="margin:0;padding:0;border:none">Inspecciones por Mes</div>
        <select id="filtro-mes-year" onchange="renderEstadisticas()" style="font-size:12px;padding:6px 10px;background:var(--surface2);border:1px solid var(--border);color:var(--text);border-radius:4px;font-weight:700"></select>
      </div>
      <div id="ch-mes"></div>
    </div>
    <div class="chart-card" style="grid-column:1/-1">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;padding-bottom:10px;border-bottom:1px solid var(--border);flex-wrap:wrap;gap:8px">
        <div class="chart-title" style="margin:0;padding:0;border:none">Inspecciones por D√≠a</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <select id="filtro-dia-mes" onchange="renderEstadisticas()" style="font-size:12px;padding:6px 10px;background:var(--surface2);border:1px solid var(--border);color:var(--text);border-radius:4px;font-weight:700">
            <option value="0">Enero</option><option value="1">Febrero</option><option value="2">Marzo</option><option value="3">Abril</option><option value="4">Mayo</option><option value="5">Junio</option><option value="6">Julio</option><option value="7">Agosto</option><option value="8">Septiembre</option><option value="9">Octubre</option><option value="10">Noviembre</option><option value="11">Diciembre</option>
          </select>
          <select id="filtro-dia-year" onchange="renderEstadisticas()" style="font-size:12px;padding:6px 10px;background:var(--surface2);border:1px solid var(--border);color:var(--text);border-radius:4px;font-weight:700"></select>
        </div>
      </div>
      <div id="ch-dia" style="overflow-x:auto"></div>
    </div>
  </div>
  <div class="table-wrapper">
    <div class="table-header"><h3>Resumen por Inspector</h3></div>
    <table>
      <thead><tr><th>Inspector</th><th>Inspecciones</th><th>Cr√≠ticas</th><th>Urgentes</th><th>Operativas</th><th>Obs. Cr√≠ticas</th></tr></thead>
      <tbody id="tabla-inspectores"></tbody>
    </table>
  </div>
</div>

<!-- ===== OBSERVACIONES ===== -->
<div class="tab" id="tab-observaciones">
  <div class="section-header">
    <h2>Hallazgos y Observaciones por Registro</h2><div class="sh-line"></div>
    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <select id="filtro-obs-nivel" onchange="renderObservaciones()" style="font-size:12px;padding:6px 12px;background:var(--surface2);border:1px solid var(--border);color:var(--text);border-radius:4px">
        <option value="">Todos los niveles</option>
        <option value="CRITICO">Solo Cr√≠ticos</option>
        <option value="ADVERTENCIA">Solo Advertencias</option>
        <option value="INFO">Solo Informativos</option>
      </select>
      <select id="filtro-obs-maq" onchange="renderObservaciones()" style="font-size:12px;padding:6px 12px;background:var(--surface2);border:1px solid var(--border);color:var(--text);border-radius:4px">
        <option value="">Todas las unidades</option>
        <option>CARGADOR FRONTAL</option><option>TRACTOR</option>
        <option>CISTERNA</option><option>BARREDORA</option><option>VOLQUETE</option>
      </select>
    </div>
  </div>
  <div id="obs-feed-container" class="obs-feed">
    <div style="text-align:center;color:var(--text2);padding:48px;background:var(--surface);border:1px solid var(--border);border-radius:6px">Sin registros a√∫n. Los hallazgos y observaciones aparecer√°n aqu√≠.</div>
  </div>
</div>

<!-- ===== CALENDARIO ===== -->
<div class="tab" id="tab-calendario">
  <div class="form-card" style="margin-bottom:20px">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:18px">
      <button class="btn btn-secondary" onclick="changeMonth(-1)" style="padding:7px 16px;font-size:18px;line-height:1">&#8249;</button>
      <div id="cal-title" style="font-size:13px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--text2)">--</div>
      <button class="btn btn-secondary" onclick="changeMonth(1)" style="padding:7px 16px;font-size:18px;line-height:1">&#8250;</button>
    </div>
    <div class="cal-header-days">
      <div class="cal-day-name">Dom</div><div class="cal-day-name">Lun</div><div class="cal-day-name">Mar</div><div class="cal-day-name">Mi√©</div><div class="cal-day-name">Jue</div><div class="cal-day-name">Vie</div><div class="cal-day-name">S√°b</div>
    </div>
    <div class="cal-grid" id="cal-grid"></div>
  </div>
  <div style="display:flex;gap:14px;align-items:center;flex-wrap:wrap">
    <span style="font-size:11px;font-weight:700;color:var(--text2);letter-spacing:1px;text-transform:uppercase">Leyenda:</span>
    <span class="badge badge-red">Cr√≠tico</span>
    <span class="badge badge-orange">Urgente / Moderado</span>
    <span class="badge badge-green">Operativa</span>
  </div>
</div>

</div><!-- /main -->

<!-- MODAL DETALLE -->
<div class="modal-overlay" id="modal-detail">
  <div class="detail-modal">
    <div class="modal-title">
      <span id="detail-id">Detalle de la Inspecci√≥n</span>
      <button class="btn btn-secondary" onclick="closeDetail()" style="padding:5px 14px;font-size:11px">Cerrar</button>
    </div>
    <div class="detail-grid" id="detail-fields"></div>
    <div id="det-criterios-sec" style="display:none">
      <div class="sub-section-title">Criterios de Inspecci√≥n</div>
      <table class="criterios-table">
        <thead><tr><th>C√≥digo</th><th>Criterio</th><th>Calificaci√≥n</th></tr></thead>
        <tbody id="det-criterios-tbody"></tbody>
      </table>
    </div>
    <div id="det-hallazgos-sec" style="display:none">
      <div class="sub-section-title">Hallazgos y Medidas</div>
      <div style="background:rgba(204,26,26,.04);border:1px solid rgba(204,26,26,.15);border-radius:5px;padding:14px;">
        <div style="font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text2);margin-bottom:4px">Hallazgos Principales</div>
        <div id="det-hallazgos-txt" style="font-size:13px;color:var(--text);line-height:1.7;white-space:pre-wrap;margin-bottom:12px">--</div>
        <div style="font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text2);margin-bottom:4px">Medidas a Tomar</div>
        <div id="det-medidas-txt" style="font-size:13px;color:var(--text);line-height:1.7;white-space:pre-wrap">--</div>
      </div>
    </div>
    <div id="det-obs-sec" style="display:none">
      <div class="sub-section-title">Observaciones para Jefatura</div>
      <div class="obs-display" id="det-obs-txt"></div>
      <div style="display:flex;gap:20px;margin-top:10px;flex-wrap:wrap">
        <span style="font-size:12px;color:var(--text2)">Reporta: <strong id="det-obs-rep" style="color:var(--text)">--</strong></span>
        <span style="font-size:12px;color:var(--text2)">Dirigido a: <strong id="det-obs-jef" style="color:var(--text)">--</strong></span>
        <span style="font-size:12px;color:var(--text2)">Nivel: <strong id="det-obs-niv" style="color:var(--red)">--</strong></span>
      </div>
    </div>
    <div id="det-photos-sec" style="display:none">
      <div class="sub-section-title">Evidencia Fotogr√°fica</div>
      <div class="detail-photos" id="det-photos-grid"></div>
    </div>
  </div>
</div>

<div class="toast" id="toast">Registro guardado</div>

<div id="loading-overlay" style="position:fixed;inset:0;background:#1a1d23;z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px">
  <div style="font-size:48px;animation:spin 1s linear infinite;display:inline-block">ü™ü</div>
  <div style="color:rgba(255,255,255,.6);font-size:13px;letter-spacing:2px;text-transform:uppercase">Cargando datos ‚Äî Febrero 2026...</div>
  <style>@keyframes spin{to{transform:rotate(360deg)}}</style>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>

var currentMonth = new Date().getMonth();
var currentYear  = new Date().getFullYear();
var currentPhotos = [];
var idCounter = 17;

var CRITERIOS_LABELS = {
  cs01:'Goma (desgaste/rajaduras)',cs02:'Presi√≥n de contacto',cs03:'Limpieza de goma',
  cs04:'Brazo portaplumilla',cs06:'Velocidades de operaci√≥n',cs07:'Sistema de lavado',
  cs08:'Nivel de l√≠quido',cs09:'Toberas de rociado',cs10:'Visibilidad parabrisas',cs11:'Plumilla trasera/lateral'
};

// ‚îÄ‚îÄ DATOS FEBRERO 2026 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
var registros = [
  {id:'PLUM-0001',fecha:'2026-02-18',maquina:'VOLQUETE',codigo:'#102',conductor:'Santos Aguilar',turno:'B',inspector:'Inspector Flota',prioridad:'CR√çTICO',estado:'FUERA DE SERVICIO',criterios:{cs01:'R',cs02:'B',cs03:'R',cs04:'B',cs06:'B',cs07:'M',cs08:'M',cs09:'M',cs10:'M',cs11:'NA'},hallazgos:'Dispensador inoperativo. Sistema de lavado sin funcionamiento. Toberas obstruidas. Visibilidad deficiente.',medidas:'Reparaci√≥n completa del sistema de lavado, recarga del dispensador, desbloqueo de toberas y evaluaci√≥n de goma para posible cambio.',proxima:'-',obs:'Unidad fuera de servicio hasta subsanar todas las observaciones.',obsNivel:'CRITICO',obsRep:'Inspector Flota',obsJef:'Jefe de Mantenimiento',fotos:[],fechaReg:'2026-02-18T07:00:00.000Z'},
  {id:'PLUM-0002',fecha:'2026-02-18',maquina:'VOLQUETE',codigo:'#104',conductor:'Kenyo Pairazaman',turno:'B',inspector:'Inspector Flota',prioridad:'CR√çTICO',estado:'FUERA DE SERVICIO',criterios:{cs01:'R',cs02:'B',cs03:'R',cs04:'B',cs06:'R',cs07:'M',cs08:'M',cs09:'M',cs10:'M',cs11:'NA'},hallazgos:'Goma con desgaste. Sistema de lavado sin funcionamiento (no bota l√≠quido). Toberas obstruidas. Visibilidad deficiente.',medidas:'Cambio de goma de plumilla, desobstrucci√≥n de toberas, reparaci√≥n del sistema de lavado. Retornar al servicio solo cuando todas las observaciones sean subsanadas.',proxima:'-',obs:'Reparaci√≥n inmediata requerida. No operar hasta subsanar.',obsNivel:'CRITICO',obsRep:'Inspector Flota',obsJef:'Jefe de Mantenimiento',fotos:[],fechaReg:'2026-02-18T07:10:00.000Z'},
  {id:'PLUM-0003',fecha:'2026-02-19',maquina:'CISTERNA',codigo:'T5H-984',conductor:'Hubert Alvites',turno:'B',inspector:'Inspector Flota',prioridad:'CR√çTICO',estado:'FUERA DE SERVICIO',criterios:{cs01:'R',cs02:'B',cs03:'R',cs04:'B',cs06:'R',cs07:'M',cs08:'M',cs09:'M',cs10:'M',cs11:'NA'},hallazgos:'Goma con desgaste. Sistema de lavado sin funcionamiento. Toberas obstruidas. Visibilidad deficiente.',medidas:'Cambio de goma, desobstrucci√≥n de toberas, reparaci√≥n del sistema de lavado. No retornar al servicio hasta subsanar y verificar todas las observaciones.',proxima:'-',obs:'Reparaci√≥n inmediata requerida. No operar hasta subsanar.',obsNivel:'CRITICO',obsRep:'Inspector Flota',obsJef:'Jefe de Mantenimiento',fotos:[],fechaReg:'2026-02-19T07:00:00.000Z'},
  {id:'PLUM-0004',fecha:'2026-02-18',maquina:'CARGADOR FRONTAL',codigo:'CAT-966 H16',conductor:'Jose Sullon',turno:'B',inspector:'Inspector Flota',prioridad:'URGENTE',estado:'MANTENIMIENTO CORRECTIVO',criterios:{cs01:'R',cs02:'R',cs03:'B',cs04:'B',cs06:'B',cs07:'B',cs08:'B',cs09:'B',cs10:'R',cs11:'NA'},hallazgos:'Plumilla descentrada sobre el parabrisas. Presi√≥n de contacto inadecuada. Limpieza y visibilidad insuficientes. En condiciones de lluvia no garantiza visibilidad m√≠nima.',medidas:'Centrar y ajustar plumilla, evaluar cambio de goma, revisar brazo portaplumilla y verificar sistema de lavado y toberas.',proxima:'-',obs:'Riesgo en condiciones de lluvia. Correcci√≥n urgente.',obsNivel:'ADVERTENCIA',obsRep:'Inspector Flota',obsJef:'Jefe de Mantenimiento',fotos:[],fechaReg:'2026-02-18T07:20:00.000Z'},
  {id:'PLUM-0005',fecha:'2026-02-18',maquina:'CARGADOR FRONTAL',codigo:'966 H15',conductor:'Sin asignar',turno:'A',inspector:'Inspector Flota',prioridad:'URGENTE',estado:'MANTENIMIENTO CORRECTIVO',criterios:{cs01:'R',cs02:'R',cs03:'R',cs04:'R',cs06:'R',cs07:'M',cs08:'R',cs09:'M',cs10:'R',cs11:'NA'},hallazgos:'Goma con endurecimiento. Sistema de lavado no funciona (no bota l√≠quido). Toberas obstruidas. M√∫ltiples criterios en nivel regular.',medidas:'Limpieza y desobstrucci√≥n de toberas, revisi√≥n del sistema de l√≠quido, reparaci√≥n del sistema de lavado, evaluaci√≥n de goma por endurecimiento.',proxima:'-',obs:'M√∫ltiples fallas. Requiere mantenimiento correctivo integral.',obsNivel:'ADVERTENCIA',obsRep:'Inspector Flota',obsJef:'Jefe de Mantenimiento',fotos:[],fechaReg:'2026-02-18T07:30:00.000Z'},
  {id:'PLUM-0006',fecha:'2026-02-18',maquina:'TRACTOR',codigo:'CAT D8T-01',conductor:'Manuel Gallo',turno:'B',inspector:'Inspector Flota',prioridad:'URGENTE',estado:'MANTENIMIENTO CORRECTIVO',criterios:{cs01:'B',cs02:'B',cs03:'R',cs04:'B',cs06:'B',cs07:'M',cs08:'R',cs09:'M',cs10:'R',cs11:'NA'},hallazgos:'Sistema de lavado inoperativo (no sale l√≠quido). Toberas obstruidas. Visibilidad irregular. Goma y brazo portaplumilla en buen estado.',medidas:'Desobstrucci√≥n de toberas, revisi√≥n del sistema de l√≠quido limpiaparabrisas.',proxima:'-',obs:'Fallas en sistema de rociado. Correcci√≥n requerida.',obsNivel:'ADVERTENCIA',obsRep:'Inspector Flota',obsJef:'Jefe de Mantenimiento',fotos:[],fechaReg:'2026-02-18T07:40:00.000Z'},
  {id:'PLUM-0007',fecha:'2026-02-18',maquina:'VOLQUETE',codigo:'TQF-919',conductor:'Jose Carranza',turno:'B',inspector:'Inspector Flota',prioridad:'URGENTE',estado:'MANTENIMIENTO CORRECTIVO',criterios:{cs01:'M',cs02:'R',cs03:'R',cs04:'R',cs06:'R',cs07:'R',cs08:'R',cs09:'M',cs10:'R',cs11:'NA'},hallazgos:'Goma con desgaste de jebe. Sistema de lavado con bajo caudal (bota poco l√≠quido). Toberas obstruidas. Visibilidad general regular.',medidas:'Desobstrucci√≥n de toberas, revisi√≥n del bajo caudal del sistema de lavado, evaluaci√≥n de cambio de goma por desgaste de jebe.',proxima:'-',obs:'Deterioro progresivo. Evaluaci√≥n de cambio de goma urgente.',obsNivel:'ADVERTENCIA',obsRep:'Inspector Flota',obsJef:'Jefe de Mantenimiento',fotos:[],fechaReg:'2026-02-18T07:50:00.000Z'},
  {id:'PLUM-0008',fecha:'2026-02-19',maquina:'CARGADOR FRONTAL',codigo:'CAT-966 H17',conductor:'Jose Quispe',turno:'A',inspector:'Inspector Flota',prioridad:'URGENTE',estado:'MANTENIMIENTO CORRECTIVO',criterios:{cs01:'B',cs02:'B',cs03:'R',cs04:'B',cs06:'B',cs07:'M',cs08:'R',cs09:'M',cs10:'M',cs11:'NA'},hallazgos:'PARABRISAS CON RAJADURA VISIBLE ‚Äî riesgo directo para el operador. Sistema de lavado inoperativo. Toberas obstruidas. Visibilidad deficiente.',medidas:'Cambio del parabrisas (URGENTE), desbloqueo de toberas, revisi√≥n t√©cnica completa del sistema de lavado. No retornar al servicio hasta subsanar todo.',proxima:'-',obs:'PELIGRO: Parabrisas rajado. No operar hasta cambio de parabrisas y reparaci√≥n completa.',obsNivel:'CRITICO',obsRep:'Inspector Flota',obsJef:'Jefe de Mantenimiento',fotos:[],fechaReg:'2026-02-19T07:10:00.000Z'},
  {id:'PLUM-0009',fecha:'2026-02-18',maquina:'CARGADOR FRONTAL',codigo:'CAT-966 H18',conductor:'Carlos Hachuca',turno:'B',inspector:'Inspector Flota',prioridad:'MODERADO',estado:'LIMPIEZA PREVENTIVA',criterios:{cs01:'B',cs02:'B',cs03:'R',cs04:'B',cs06:'B',cs07:'B',cs08:'B',cs09:'B',cs10:'B',cs11:'NA'},hallazgos:'Material compactado en goma. Resto de componentes en buen estado.',medidas:'Limpieza general del parabrisas antes del inicio del pr√≥ximo turno.',proxima:'-',obs:'Solo requiere limpieza preventiva.',obsNivel:'INFO',obsRep:'Inspector Flota',obsJef:'Jefe de Mantenimiento',fotos:[],fechaReg:'2026-02-18T08:00:00.000Z'},
  {id:'PLUM-0010',fecha:'2026-02-19',maquina:'CARGADOR FRONTAL',codigo:'966L-4',conductor:'Lito Ipanague Bueno',turno:'A',inspector:'Inspector Flota',prioridad:'MODERADO',estado:'LIMPIEZA PREVENTIVA',criterios:{cs01:'B',cs02:'B',cs03:'R',cs04:'B',cs06:'B',cs07:'B',cs08:'B',cs09:'B',cs10:'B',cs11:'NA'},hallazgos:'Material compactado sobre el parabrisas. Sistema de lavado y plumillas en buen estado.',medidas:'Limpieza del parabrisas antes de operar.',proxima:'-',obs:'Solo requiere limpieza del parabrisas.',obsNivel:'INFO',obsRep:'Inspector Flota',obsJef:'Jefe de Mantenimiento',fotos:[],fechaReg:'2026-02-19T07:20:00.000Z'},
  {id:'PLUM-0011',fecha:'2026-02-19',maquina:'BARREDORA',codigo:'Barredora #01',conductor:'Jose Biminchumo',turno:'A',inspector:'Inspector Flota',prioridad:'NORMAL',estado:'OPERATIVA',criterios:{cs01:'B',cs02:'B',cs03:'B',cs04:'B',cs06:'B',cs07:'B',cs08:'B',cs09:'B',cs10:'B',cs11:'NA'},hallazgos:'Todos los criterios aprobados.',medidas:'No se requiere intervenci√≥n. Continuar con programa de mantenimiento preventivo.',proxima:'-',obs:'',obsNivel:'INFO',obsRep:'',obsJef:'',fotos:[],fechaReg:'2026-02-19T08:00:00.000Z'},
  {id:'PLUM-0012',fecha:'2026-02-19',maquina:'CISTERNA',codigo:'CAB-948',conductor:'Hubert Alvites',turno:'A',inspector:'Inspector Flota',prioridad:'NORMAL',estado:'OPERATIVA',criterios:{cs01:'B',cs02:'B',cs03:'B',cs04:'B',cs06:'B',cs07:'B',cs08:'B',cs09:'B',cs10:'B',cs11:'NA'},hallazgos:'Todos los criterios aprobados. Dispensador operativo.',medidas:'No se requiere acci√≥n. Mantener rutina de inspecci√≥n mensual.',proxima:'-',obs:'',obsNivel:'INFO',obsRep:'',obsJef:'',fotos:[],fechaReg:'2026-02-19T08:10:00.000Z'},
  {id:'PLUM-0013',fecha:'2026-01-18',maquina:'CARGADOR FRONTAL',codigo:'CAT 966-5',conductor:'Henry Mari√±as',turno:'A',inspector:'Inspector Flota',prioridad:'NORMAL',estado:'OPERATIVA',criterios:{cs01:'B',cs02:'B',cs03:'B',cs04:'B',cs06:'B',cs07:'B',cs08:'B',cs09:'B',cs10:'B',cs11:'NA'},hallazgos:'Todos los criterios aprobados.',medidas:'No se requiere intervenci√≥n. Mantener mantenimiento preventivo.',proxima:'-',obs:'',obsNivel:'INFO',obsRep:'',obsJef:'',fotos:[],fechaReg:'2026-01-18T08:00:00.000Z'},
  {id:'PLUM-0014',fecha:'2026-02-18',maquina:'CARGADOR FRONTAL',codigo:'CAT 966-4',conductor:'Sanchez Vilchez',turno:'B',inspector:'Inspector Flota',prioridad:'NORMAL',estado:'OPERATIVA',criterios:{cs01:'B',cs02:'B',cs03:'B',cs04:'B',cs06:'B',cs07:'B',cs08:'B',cs09:'B',cs10:'B',cs11:'NA'},hallazgos:'Todos los criterios aprobados.',medidas:'No se requiere acci√≥n. Continuar programa de mantenimiento preventivo.',proxima:'-',obs:'',obsNivel:'INFO',obsRep:'',obsJef:'',fotos:[],fechaReg:'2026-02-18T08:20:00.000Z'},
  {id:'PLUM-0015',fecha:'2026-02-18',maquina:'VOLQUETE',codigo:'CFV-908',conductor:'Kenyo Poirazaman',turno:'B',inspector:'Inspector Flota',prioridad:'NORMAL',estado:'OPERATIVA',criterios:{cs01:'B',cs02:'B',cs03:'B',cs04:'B',cs06:'B',cs07:'B',cs08:'B',cs09:'B',cs10:'B',cs11:'NA'},hallazgos:'Todos los criterios aprobados.',medidas:'No se requiere acci√≥n. Mantener programa de mantenimiento preventivo.',proxima:'-',obs:'',obsNivel:'INFO',obsRep:'',obsJef:'',fotos:[],fechaReg:'2026-02-18T08:30:00.000Z'},
  {id:'PLUM-0016',fecha:'2026-02-18',maquina:'TRACTOR',codigo:'D8T-1',conductor:'Jose Torres',turno:'A',inspector:'Inspector Flota',prioridad:'NORMAL',estado:'OPERATIVA',criterios:{cs01:'B',cs02:'B',cs03:'B',cs04:'B',cs06:'B',cs07:'B',cs08:'B',cs09:'B',cs10:'B',cs11:'B'},hallazgos:'Todos los criterios aprobados incluyendo plumilla trasera.',medidas:'No se requiere intervenci√≥n. Mantener mantenimiento preventivo.',proxima:'-',obs:'',obsNivel:'INFO',obsRep:'',obsJef:'',fotos:[],fechaReg:'2026-02-18T08:40:00.000Z'}
];


function updateClock(){var now=new Date(),dias=['DOM','LUN','MAR','MIE','JUE','VIE','SAB'],m=['ENE','FEB','MAR','ABR','MAY','JUN','JUL','AGO','SEP','OCT','NOV','DIC'];document.getElementById('clockDisplay').textContent=dias[now.getDay()]+' '+now.getDate()+' '+m[now.getMonth()]+' - '+now.getHours().toString().padStart(2,'0')+':'+now.getMinutes().toString().padStart(2,'0');}
setInterval(updateClock,1000); updateClock();
document.getElementById('f-fecha').valueAsDate=new Date();
var tabMap={dashboard:0,registro:1,historial:2,estadisticas:3,observaciones:4,calendario:5};

function showTab(id){document.querySelectorAll('.tab').forEach(function(t){t.classList.remove('active');});document.querySelectorAll('.nav-btn').forEach(function(b){b.classList.remove('active');});document.getElementById('tab-'+id).classList.add('active');document.querySelectorAll('.nav-btn')[tabMap[id]].classList.add('active');if(id==='calendario')renderCalendar();if(id==='historial')renderHistorial();if(id==='dashboard')renderDashboard();if(id==='estadisticas')renderEstadisticas();if(id==='observaciones')renderObservaciones();}

function selectPrioridad(el,val){document.querySelectorAll('.prio-btn').forEach(function(b){b.classList.remove('selected');});el.classList.add('selected');document.getElementById('f-prioridad').value=val;
  // Auto-set estado
  var estado=document.getElementById('f-estado');
  if(val==='CR√çTICO')estado.value='MANTENIMIENTO URGENTE';
  else if(val==='URGENTE')estado.value='MANTENIMIENTO CORRECTIVO';
  else if(val==='MODERADO')estado.value='LIMPIEZA PREVENTIVA';
  else estado.value='OPERATIVA';
}
function selectMachine(name){document.getElementById('f-maquina').value=name;showTab('registro');}
function selectNivel(nivel){document.getElementById('f-obs-nivel').value=nivel;['info','warning','critical'].forEach(function(n){document.getElementById('obs-btn-'+n).className='obs-nivel-btn';});if(nivel==='INFO')document.getElementById('obs-btn-info').classList.add('sel-info');if(nivel==='ADVERTENCIA')document.getElementById('obs-btn-warning').classList.add('sel-warning');if(nivel==='CRITICO')document.getElementById('obs-btn-critical').classList.add('sel-critical');}

function colorCriterio(sel){sel.className='criterio-select val-'+sel.value;}
document.querySelectorAll('.criterio-select').forEach(colorCriterio);

function guardarRegistro(){
  var maquina=document.getElementById('f-maquina').value;
  var fecha=document.getElementById('f-fecha').value;
  var prioridad=document.getElementById('f-prioridad').value;
  if(!maquina||!fecha||!prioridad){showToast('Complete Unidad, Fecha y Prioridad','warn');return;}
  var id='PLUM-'+String(idCounter).padStart(4,'0');
  var criterios={};
  ['cs01','cs02','cs03','cs04','cs06','cs07','cs08','cs09','cs10','cs11'].forEach(function(c){criterios[c]=document.getElementById(c).value;});
  var reg={id:id,fecha:fecha,maquina:maquina,
    codigo:document.getElementById('f-codigo').value||'-',
    conductor:document.getElementById('f-conductor').value||'-',
    turno:document.getElementById('f-turno').value,
    inspector:document.getElementById('f-inspector').value||'-',
    prioridad:prioridad,
    estado:document.getElementById('f-estado').value,
    criterios:criterios,
    hallazgos:document.getElementById('f-hallazgos').value||'-',
    medidas:document.getElementById('f-medidas').value||'-',
    proxima:document.getElementById('f-proxima').value||'-',
    obs:document.getElementById('f-observaciones').value||'',
    obsNivel:document.getElementById('f-obs-nivel').value||'INFO',
    obsRep:document.getElementById('f-obs-reporta').value||'-',
    obsJef:document.getElementById('f-obs-jefatura').value||'-',
    fotos:currentPhotos.slice(),tieneFotos:currentPhotos.length>0,
    fechaReg:new Date().toISOString()
  };
  idCounter++;
  registros.unshift(reg);
  showToast('Inspecci√≥n '+id+' guardada correctamente');
  renderDashboard();
  clearForm();
}

function eliminarRegistro(id){
  if(!confirm('Eliminar '+id+'? No se puede deshacer.'))return;
  registros=registros.filter(function(r){return r.id!==id;});
  renderDashboard();
  renderHistorial();
  showToast('Registro '+id+' eliminado');
}

function clearForm(){
  ['f-maquina','f-codigo','f-conductor','f-inspector','f-hallazgos','f-medidas','f-proxima','f-observaciones','f-obs-reporta','f-obs-jefatura'].forEach(function(id){var el=document.getElementById(id);if(el)el.value='';});
  document.getElementById('f-fecha').valueAsDate=new Date();
  document.getElementById('f-turno').value='A';
  document.getElementById('f-estado').value='OPERATIVA';
  document.getElementById('f-prioridad').value='';
  document.getElementById('f-obs-nivel').value='INFO';
  document.querySelectorAll('.prio-btn').forEach(function(b){b.classList.remove('selected');});
  ['cs01','cs02','cs03','cs04','cs06','cs07','cs08','cs09','cs10','cs11'].forEach(function(c){var s=document.getElementById(c);s.value='B';colorCriterio(s);});
  currentPhotos=[]; document.getElementById('photo-preview').innerHTML=''; document.getElementById('photo-count').textContent='';
  selectNivel('INFO');
}

function prioBadge(p){if(p==='CR√çTICO')return 'badge-red';if(p==='URGENTE')return 'badge-orange';if(p==='MODERADO')return 'badge-blue';return 'badge-green';}
function estadoBadge(e){if(e==='FUERA DE SERVICIO'||e==='MANTENIMIENTO URGENTE')return 'badge-red';if(e==='MANTENIMIENTO CORRECTIVO')return 'badge-orange';if(e==='LIMPIEZA PREVENTIVA')return 'badge-blue';return 'badge-green';}
function nivelBadge(n){if(n==='CRITICO')return 'badge-red';if(n==='ADVERTENCIA')return 'badge-orange';return 'badge-blue';}

function renderDashboard(){
  document.getElementById('stat-total').textContent=registros.length;
  document.getElementById('stat-critico').textContent=registros.filter(function(r){return r.prioridad==='CR√çTICO';}).length;
  document.getElementById('stat-urgente').textContent=registros.filter(function(r){return r.prioridad==='URGENTE';}).length;
  document.getElementById('stat-operativa').textContent=registros.filter(function(r){return r.prioridad==='NORMAL';}).length;
  document.getElementById('stat-mant').textContent=registros.filter(function(r){return r.prioridad==='CR√çTICO'||r.prioridad==='URGENTE';}).length;
  var M=['CARGADOR FRONTAL','TRACTOR','CISTERNA','BARREDORA','VOLQUETE'],A=['CF','TR','CI','BA','VO'];
  M.forEach(function(m,i){
    var all=registros.filter(function(r){return r.maquina===m;});
    var last=all[0];
    document.getElementById('count-'+A[i]).textContent=all.length+' inspeccion'+(all.length!==1?'es':'');
    var el=document.getElementById('status-'+A[i]);
    if(last&&(last.prioridad==='CR√çTICO')){el.textContent='FUERA DE SERVICIO';el.className='machine-status status-out';}
    else if(last&&last.prioridad==='URGENTE'){el.textContent='MANTENIMIENTO';el.className='machine-status status-maint';}
    else{el.textContent='OPERATIVO';el.className='machine-status status-ok';}
  });
  var tbody=document.getElementById('recent-tbody');
  var slice=registros.slice(0,5);
  if(!slice.length){tbody.innerHTML='<tr><td colspan="8" style="text-align:center;color:var(--text2);padding:32px">Sin registros a√∫n.</td></tr>';return;}
  tbody.innerHTML=slice.map(function(r){var hasObs=r.obs&&r.obs.trim().length>0;return '<tr><td class="mono" style="color:var(--red)">'+r.id+'</td><td>'+r.fecha+'</td><td style="font-weight:600">'+r.maquina+'</td><td class="mono">'+(r.codigo||'-')+'</td><td>'+(r.conductor||'-')+'</td><td><span class="badge '+prioBadge(r.prioridad)+'">'+r.prioridad+'</span></td><td><span class="badge '+estadoBadge(r.estado)+'">'+r.estado+'</span></td><td>'+(hasObs?'<span class="badge '+nivelBadge(r.obsNivel)+'">'+r.obsNivel+'</span>':'-')+'</td></tr>';}).join('');
}

function renderHistorial(){
  var filtroM=document.getElementById('filtro-maquina').value;
  var filtroP=document.getElementById('filtro-prioridad').value;
  var data=registros.filter(function(r){return(!filtroM||r.maquina===filtroM)&&(!filtroP||r.prioridad===filtroP);});
  var tbody=document.getElementById('historial-tbody');
  if(!data.length){tbody.innerHTML='<tr><td colspan="10" style="text-align:center;color:var(--text2);padding:32px">Sin registros.</td></tr>';return;}
  tbody.innerHTML='';
  data.forEach(function(r){
    var hasObs=r.obs&&r.obs.trim().length>0;
    var tr=document.createElement('tr');
    tr.innerHTML='<td class="mono" style="color:var(--red)">'+r.id+'</td><td>'+r.fecha+'</td><td style="font-weight:600">'+r.maquina+'</td><td class="mono">'+(r.codigo||'-')+'</td><td>'+(r.conductor||'-')+'</td><td><span class="badge '+prioBadge(r.prioridad)+'">'+r.prioridad+'</span></td><td><span class="badge '+estadoBadge(r.estado)+'">'+r.estado+'</span></td><td>'+(hasObs?'<span class="badge '+nivelBadge(r.obsNivel)+'">'+r.obsNivel+'</span>':'-')+'</td>';
    var tdV=document.createElement('td');var bV=document.createElement('button');bV.className='btn btn-secondary';bV.style.cssText='padding:3px 10px;font-size:10px';bV.textContent='VER';bV.onclick=(function(id){return function(){openDetail(id);};})(r.id);tdV.appendChild(bV);tr.appendChild(tdV);
    var tdD=document.createElement('td');var bD=document.createElement('button');bD.className='btn';bD.style.cssText='padding:3px 10px;font-size:10px;background:rgba(204,26,26,.1);color:var(--red);border:1px solid rgba(204,26,26,.3)';bD.textContent='ELIMINAR';bD.onclick=(function(id){return function(){eliminarRegistro(id);};})(r.id);tdD.appendChild(bD);tr.appendChild(tdD);
    tbody.appendChild(tr);
  });
}

function renderObservaciones(){
  var filtroN=document.getElementById('filtro-obs-nivel').value;
  var filtroM=document.getElementById('filtro-obs-maq').value;
  var data=registros.filter(function(r){var hasH=r.hallazgos&&r.hallazgos!=='-';var hasO=r.obs&&r.obs.trim().length>0;if(!hasH&&!hasO)return false;if(filtroN&&r.obsNivel!==filtroN)return false;if(filtroM&&r.maquina!==filtroM)return false;return true;});
  var cont=document.getElementById('obs-feed-container');
  if(!data.length){cont.innerHTML='<div style="text-align:center;color:var(--text2);padding:48px;background:var(--surface);border:1px solid var(--border);border-radius:6px">Sin observaciones.</div>';return;}
  cont.innerHTML=data.map(function(r){var hasH=r.hallazgos&&r.hallazgos!=='-';var hasO=r.obs&&r.obs.trim().length>0;var nc=r.obsNivel||'INFO';return '<div class="obs-card c-'+nc+'"><div class="obs-card-top"><span class="mono" style="color:var(--red);font-size:11px">'+r.id+'</span><span class="badge badge-gray">'+r.fecha+'</span><span class="badge badge-gray">'+r.maquina+'</span><span class="badge '+prioBadge(r.prioridad)+'">'+r.prioridad+'</span>'+(hasO?'<span class="badge '+nivelBadge(nc)+'">'+nc+'</span>':'')+'<span style="font-size:12px;color:var(--text2)">Inspector: <strong style="color:var(--text)">'+r.inspector+'</strong></span></div>'+(hasH?'<div class="obs-card-motivo"><div class="obs-card-motivo-label">Hallazgos principales</div><div class="obs-card-motivo-text">'+r.hallazgos+'</div></div>':'')+(hasO?'<div class="obs-card-obs c-'+nc+'"><div style="font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text2);margin-bottom:6px">Observaci√≥n para jefatura</div><div style="font-size:13px;color:var(--text);line-height:1.7">'+r.obs+'</div></div>':'')+'<div class="obs-card-meta"><span>Conductor: <strong>'+(r.conductor||'-')+'</strong></span><span>Estado: <strong>'+r.estado+'</strong></span><span>Turno: <strong>'+r.turno+'</strong></span></div></div>';}).join('');
}

function renderEstadisticas(){
  var filtroEl=document.getElementById('filtro-estadistica');
  var filtroUnidad=filtroEl?filtroEl.value:'';
  var data=filtroUnidad?registros.filter(function(r){return r.maquina===filtroUnidad;}):registros;
  document.getElementById('kpi-total').textContent=data.length;
  document.getElementById('kpi-critico').textContent=data.filter(function(r){return r.prioridad==='CR√çTICO'||r.prioridad==='URGENTE';}).length;
  document.getElementById('kpi-hallazgos').textContent=data.filter(function(r){return r.hallazgos&&r.hallazgos!=='-';}).length;
  document.getElementById('kpi-operativas').textContent=data.filter(function(r){return r.prioridad==='NORMAL';}).length;
  var M=['CARGADOR FRONTAL','TRACTOR','CISTERNA','BARREDORA','VOLQUETE'],A=['CF','TR','CI','BA','VO'],MC=['#cc1a1a','#1a5fa0','#1a7a45','#c06010','#6a7080'];
  function bars(elId,labels,vals,colors,unit){unit=unit||'';var max=Math.max.apply(null,vals.concat([1]));document.getElementById(elId).innerHTML=labels.map(function(l,i){var pct=(vals[i]/max*100).toFixed(1);return '<div class="bar-row"><div class="bar-label">'+l+'</div><div class="bar-track"><div class="bar-fill" style="width:'+pct+'%;background:'+(colors[i]||'#cc1a1a')+'">'+vals[i]+unit+'</div></div><div class="bar-val">'+vals[i]+unit+'</div></div>';}).join('');}
  bars('ch-maq',A,M.map(function(m){return data.filter(function(r){return r.maquina===m;}).length;}),MC);
  var P=['CR√çTICO','URGENTE','MODERADO','NORMAL'];
  bars('ch-prio',P,P.map(function(p){return data.filter(function(r){return r.prioridad===p;}).length;}),['#cc1a1a','#c06010','#b8860b','#1a7a45']);
  var ES=['OPERATIVA','LIMPIEZA PREVENTIVA','MANT. CORRECTIVO','MANT. URGENTE','FUERA DE SERVICIO'];
  var ESmap={'OPERATIVA':'OPERATIVA','LIMPIEZA PREVENTIVA':'LIMPIEZA PREVENTIVA','MANT. CORRECTIVO':'MANTENIMIENTO CORRECTIVO','MANT. URGENTE':'MANTENIMIENTO URGENTE','FUERA DE SERVICIO':'FUERA DE SERVICIO'};
  bars('ch-estado',['OPERATIVA','PREV.','CORRECTIVO','URGENTE','F.SERVICIO'],ES.map(function(e){return data.filter(function(r){return r.estado===ESmap[e];}).length;}),['#1a7a45','#1a5fa0','#c06010','#cc1a1a','#6a7080']);
  // Criterios
  function critBar(elId,ckey){var B=0,R=0,M2=0;data.forEach(function(r){if(r.criterios){var v=r.criterios[ckey];if(v==='B')B++;else if(v==='R')R++;else if(v==='M')M2++;}});bars(elId,['Bueno','Regular','Malo'],[B,R,M2],['#1a7a45','#c06010','#cc1a1a']);}
  critBar('ch-cs01','cs01'); critBar('ch-cs07','cs07'); critBar('ch-cs09','cs09');
  // Por mes
  var yearSet=new Set();data.forEach(function(r){if(r.fecha)yearSet.add(r.fecha.slice(0,4));});var years=Array.from(yearSet).sort();var ysel=document.getElementById('filtro-mes-year');var curY=ysel.value||years[years.length-1]||String(new Date().getFullYear());if(!ysel.options.length||ysel.dataset.built!=='1'){ysel.innerHTML=years.map(function(y){return '<option value="'+y+'"'+(y===curY?' selected':'')+'>'+y+'</option>';}).join('');ysel.dataset.built='1';}
  var meses=['ENE','FEB','MAR','ABR','MAY','JUN','JUL','AGO','SEP','OCT','NOV','DIC'];
  var byMes=meses.map(function(_,i){return data.filter(function(r){return r.fecha&&r.fecha.slice(0,4)===curY&&parseInt(r.fecha.slice(5,7))-1===i;}).length;});
  bars('ch-mes',meses,byMes,meses.map(function(){return '#cc1a1a';}));
  // Por dia
  var dYSel=document.getElementById('filtro-dia-year');var dMSel=document.getElementById('filtro-dia-mes');if(!dYSel.options.length||dYSel.dataset.built!=='1'){dYSel.innerHTML=years.map(function(y){return '<option value="'+y+'"'+(y===curY?' selected':'')+'>'+y+'</option>';}).join('');dYSel.dataset.built='1';}
  var dY=dYSel.value||curY,dM=parseInt(dMSel.value);var dim=new Date(parseInt(dY),dM+1,0).getDate();var dias=[];for(var d=1;d<=dim;d++)dias.push(d);var byDia=dias.map(function(d){var ds=dY+'-'+String(dM+1).padStart(2,'0')+'-'+String(d).padStart(2,'0');return data.filter(function(r){return r.fecha===ds;}).length;});
  var maxD=Math.max.apply(null,byDia.concat([1]));document.getElementById('ch-dia').innerHTML='<div style="display:flex;align-items:flex-end;gap:3px;height:80px;padding:0 2px">'+dias.map(function(d,i){var pct=(byDia[i]/maxD*100);return '<div style="display:flex;flex-direction:column;align-items:center;flex:1;min-width:18px"><div style="width:100%;background:'+(byDia[i]>0?'#cc1a1a':'var(--surface2)')+';height:'+Math.max(pct,4)+'%;border-radius:2px 2px 0 0;cursor:pointer" title="D√≠a '+d+': '+byDia[i]+' inspecciones"></div><div style="font-size:9px;color:var(--text3);margin-top:3px">'+d+'</div></div>';}).join('')+'</div>';
  // Tabla inspectores
  var inspMap={};data.forEach(function(r){var s=r.inspector||'Sin asignar';if(!inspMap[s])inspMap[s]={total:0,critico:0,urgente:0,normal:0,obsC:0};inspMap[s].total++;if(r.prioridad==='CR√çTICO')inspMap[s].critico++;if(r.prioridad==='URGENTE')inspMap[s].urgente++;if(r.prioridad==='NORMAL')inspMap[s].normal++;if(r.obs&&r.obsNivel==='CRITICO')inspMap[s].obsC++;});
  var tbody=document.getElementById('tabla-inspectores');
  var entries=Object.keys(inspMap).map(function(k){return[k,inspMap[k]];}).sort(function(a,b){return b[1].total-a[1].total;});
  if(!entries.length){tbody.innerHTML='<tr><td colspan="6" style="text-align:center;color:var(--text2);padding:24px">Sin datos.</td></tr>';return;}
  tbody.innerHTML=entries.map(function(e){var s=e[0],d=e[1];return '<tr><td style="font-weight:600">'+s+'</td><td class="mono" style="text-align:center;color:var(--blue);font-weight:700">'+d.total+'</td><td style="text-align:center"><span class="badge badge-red">'+d.critico+'</span></td><td style="text-align:center"><span class="badge badge-orange">'+d.urgente+'</span></td><td style="text-align:center"><span class="badge badge-green">'+d.normal+'</span></td><td style="text-align:center">'+(d.obsC>0?'<span class="badge badge-red">'+d.obsC+'</span>':'-')+'</td></tr>';}).join('');
}

function renderCalendar(){
  var meses=['ENERO','FEBRERO','MARZO','ABRIL','MAYO','JUNIO','JULIO','AGOSTO','SEPTIEMBRE','OCTUBRE','NOVIEMBRE','DICIEMBRE'];
  document.getElementById('cal-title').textContent=meses[currentMonth]+' '+currentYear;
  var grid=document.getElementById('cal-grid');
  var firstDay=new Date(currentYear,currentMonth,1).getDay();
  var dim=new Date(currentYear,currentMonth+1,0).getDate();
  var today=new Date();var html='';
  for(var i=0;i<firstDay;i++)html+='<div class="cal-day" style="opacity:.25;border:1px dashed var(--border)"></div>';
  for(var d=1;d<=dim;d++){
    var ds=currentYear+'-'+String(currentMonth+1).padStart(2,'0')+'-'+String(d).padStart(2,'0');
    var isT=d===today.getDate()&&currentMonth===today.getMonth()&&currentYear===today.getFullYear();
    var dr=registros.filter(function(r){return r.fecha===ds||r.proxima===ds;});
    html+='<div class="cal-day '+(isT?'today':'')+(dr.length?' has-event':'')+'"><div style="font-size:12px;font-weight:'+(isT?700:400)+';margin-bottom:2px">'+d+'</div>'+dr.map(function(r){var cls=r.prioridad==='NORMAL'?'operativa':r.prioridad==='CR√çTICO'?'critico':'';return '<div class="cal-event '+cls+'">'+r.codigo.split(' ')[0]+'</div>';}).join('')+'</div>';
  }
  grid.innerHTML=html;
}
function changeMonth(dir){currentMonth+=dir;if(currentMonth>11){currentMonth=0;currentYear++;}if(currentMonth<0){currentMonth=11;currentYear--;}renderCalendar();}

function openDetail(id){
  var r=registros.find(function(x){return x.id===id;});
  if(!r)return;
  document.getElementById('detail-id').textContent=r.id+' ‚Äî '+r.maquina+' '+r.codigo;
  var fields=[{l:'Fecha',v:r.fecha},{l:'Unidad',v:r.maquina},{l:'C√≥digo/Placa',v:r.codigo},{l:'Conductor',v:r.conductor},{l:'Turno',v:r.turno},{l:'Inspector',v:r.inspector},{l:'Prioridad',v:r.prioridad},{l:'Estado',v:r.estado},{l:'Pr√≥x. Inspecci√≥n',v:r.proxima},{l:'N¬∞ Registro',v:r.id},{l:'Fecha Registro',v:r.fechaReg?r.fechaReg.slice(0,10):'-'}];
  document.getElementById('detail-fields').innerHTML=fields.map(function(f){return '<div class="detail-field"><div class="df-label">'+f.l+'</div><div class="df-val">'+(f.v||'-')+'</div></div>';}).join('');
  // Criterios
  if(r.criterios){
    document.getElementById('det-criterios-sec').style.display='block';
    var keys=['cs01','cs02','cs03','cs04','cs06','cs07','cs08','cs09','cs10','cs11'];
    document.getElementById('det-criterios-tbody').innerHTML=keys.map(function(k){var v=r.criterios[k]||'N/A';var cls=v==='B'?'crit-B':v==='R'?'crit-R':v==='M'?'crit-M':'crit-NA';return '<tr><td class="mono">'+k.toUpperCase()+'</td><td>'+CRITERIOS_LABELS[k]+'</td><td class="'+cls+'">'+v+'</td></tr>';}).join('');
  } else document.getElementById('det-criterios-sec').style.display='none';
  // Hallazgos
  var hasH=r.hallazgos&&r.hallazgos!=='-';
  if(hasH){document.getElementById('det-hallazgos-sec').style.display='block';document.getElementById('det-hallazgos-txt').textContent=r.hallazgos;document.getElementById('det-medidas-txt').textContent=r.medidas||'-';}else{document.getElementById('det-hallazgos-sec').style.display='none';}
  // Obs
  var hasObs=r.obs&&r.obs.trim().length>0;
  if(hasObs){document.getElementById('det-obs-sec').style.display='block';var obsEl=document.getElementById('det-obs-txt');obsEl.textContent=r.obs;obsEl.className='obs-display nivel-'+(r.obsNivel||'INFO').toLowerCase();document.getElementById('det-obs-rep').textContent=r.obsRep||'-';document.getElementById('det-obs-jef').textContent=r.obsJef||'-';var nEl=document.getElementById('det-obs-niv');nEl.textContent=r.obsNivel||'INFO';nEl.style.color=r.obsNivel==='CRITICO'?'var(--red)':r.obsNivel==='ADVERTENCIA'?'var(--orange)':'var(--blue)';}else{document.getElementById('det-obs-sec').style.display='none';}
  // Photos
  var pS=document.getElementById('det-photos-sec');
  if(r.fotos&&r.fotos.length){pS.style.display='block';document.getElementById('det-photos-grid').innerHTML=r.fotos.map(function(p){return '<div class="detail-photo"><img src="'+p.data+'" alt="'+p.name+'" style="cursor:pointer" onclick="verFoto(this.src)"></div>';}).join('');}else{pS.style.display='none';}
  document.getElementById('modal-detail').classList.add('show');
}
function closeDetail(){document.getElementById('modal-detail').classList.remove('show');}
function verFoto(src){window.open(src,'_blank');}

function handlePhotos(files){Array.from(files).slice(0,5-currentPhotos.length).forEach(function(file){if(!file.type.startsWith('image/'))return;var reader=new FileReader();reader.onload=function(e){currentPhotos.push({name:file.name,data:e.target.result});renderPhotoPreview();};reader.readAsDataURL(file);});}
function renderPhotoPreview(){var g=document.getElementById('photo-preview'),c=document.getElementById('photo-count');if(!currentPhotos.length){g.innerHTML='';c.textContent='';return;}g.innerHTML=currentPhotos.map(function(p,i){return '<div class="photo-thumb"><img src="'+p.data+'" alt="'+p.name+'"><div class="photo-label">'+p.name+'</div><button class="photo-remove" onclick="removePhoto('+i+')">X</button></div>';}).join('');c.textContent=currentPhotos.length+' fotograf√≠a(s) adjunta(s)';}
function removePhoto(idx){currentPhotos.splice(idx,1);renderPhotoPreview();}

document.addEventListener('DOMContentLoaded',function(){
  var area=document.getElementById('upload-area');
  if(area){area.addEventListener('dragover',function(e){e.preventDefault();area.classList.add('dragover');});area.addEventListener('dragleave',function(){area.classList.remove('dragover');});area.addEventListener('drop',function(e){e.preventDefault();area.classList.remove('dragover');handlePhotos(e.dataTransfer.files);});}
  var md=document.getElementById('modal-detail');
  if(md)md.addEventListener('click',function(e){if(e.target===this)closeDetail();});
  document.getElementById('filtro-dia-mes').value=new Date().getMonth();
  renderDashboard();
  document.getElementById('loading-overlay').style.display='none';
});

function exportarExcel(){
  if(!registros.length){showToast('No hay registros','warn');return;}
  if(typeof XLSX==='undefined'){showToast('Cargando...','warn');return;}
  var wb=XLSX.utils.book_new();
  var datos=registros.map(function(r){return{
    'N. Registro':r.id,'Fecha':r.fecha,'Unidad':r.maquina,'C√≥digo':r.codigo||'-',
    'Conductor':r.conductor||'-','Turno':r.turno||'-','Inspector':r.inspector||'-',
    'Prioridad':r.prioridad,'Estado':r.estado,
    'CS01-Goma':r.criterios?r.criterios.cs01:'-','CS02-Presi√≥n':r.criterios?r.criterios.cs02:'-',
    'CS03-Limpieza':r.criterios?r.criterios.cs03:'-','CS04-Brazo':r.criterios?r.criterios.cs04:'-',
    'CS06-Velocidad':r.criterios?r.criterios.cs06:'-','CS07-Lavado':r.criterios?r.criterios.cs07:'-',
    'CS08-L√≠quido':r.criterios?r.criterios.cs08:'-','CS09-Toberas':r.criterios?r.criterios.cs09:'-',
    'CS10-Visibilidad':r.criterios?r.criterios.cs10:'-','CS11-Plum.Trasera':r.criterios?r.criterios.cs11:'-',
    'Hallazgos':r.hallazgos||'-','Medidas':r.medidas||'-','Pr√≥x. Inspecci√≥n':r.proxima||'-',
    'Observaci√≥n':r.obs||'-','Nivel Obs.':r.obsNivel||'INFO',
    'F. Registro':r.fechaReg?r.fechaReg.slice(0,10):'-'
  };});
  var ws1=XLSX.utils.json_to_sheet(datos);
  ws1['!cols']=[{wch:14},{wch:12},{wch:20},{wch:14},{wch:20},{wch:8},{wch:18},{wch:10},{wch:22},{wch:8},{wch:8},{wch:8},{wch:8},{wch:8},{wch:8},{wch:8},{wch:8},{wch:8},{wch:8},{wch:35},{wch:30},{wch:15},{wch:40},{wch:12},{wch:14}];
  XLSX.utils.book_append_sheet(wb,ws1,'Inspecciones');
  var M=['CARGADOR FRONTAL','TRACTOR','CISTERNA','BARREDORA','VOLQUETE'];
  var ws2=XLSX.utils.json_to_sheet(M.map(function(m){var regs=registros.filter(function(r){return r.maquina===m;});return{'Unidad':m,'Inspecciones':regs.length,'Cr√≠ticas':regs.filter(function(r){return r.prioridad==='CR√çTICO';}).length,'Urgentes':regs.filter(function(r){return r.prioridad==='URGENTE';}).length,'Operativas':regs.filter(function(r){return r.prioridad==='NORMAL';}).length};}));
  XLSX.utils.book_append_sheet(wb,ws2,'Por Unidad');
  XLSX.writeFile(wb,'Plumillas_'+new Date().toISOString().slice(0,10)+'.xlsx');
  showToast('Excel exportado correctamente');
}

function showToast(msg,type){var t=document.getElementById('toast');t.textContent=msg;t.style.borderColor=type==='warn'?'var(--orange)':'var(--green)';t.style.color=type==='warn'?'var(--orange)':'#4ecf90';t.style.display='block';setTimeout(function(){t.style.display='none';},3200);}
</script>
</body>
</html>
